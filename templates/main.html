<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>训练工具</title>
        <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/static/css/main.css">
    </head>
    <body>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h2>训练工具</h2>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span id="currentUser" style="color: #666;">加载中...</span>
                <a href="/auth/admin" id="adminLink" style="color: #4a90e2; text-decoration: none; display: none;">管理面板</a>
                <a href="/welcome" style="color: #4a90e2; text-decoration: none;">重新配置</a>
                <form method="POST" action="/auth/logout" style="display: inline; margin: 0;">
                    <button type="submit" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">登出</button>
                </form>
            </div>
        </div>
        <!-- 选项卡 -->
         <div>
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'performance')" id="performanceBtn">性能监控</button>
                <button class="tablinks" onclick="openTab(event, 'logs')" id="logsBtn">日志检查</button>
                <button class="tablinks" onclick="openTab(event, 'tree')" id="treeBtn">文件树</button>
                <button class="tablinks" onclick="openTab(event, 'tensorboard')" id="tensorboardBtn" style="display:none;">TensorBoard</button>
            </div>
            <div class="tabcontent" id="performance">
                <h3>性能监控</h3>
                <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                    <div id="cpu" style="width: 600px; height:400px;"></div>
                    <div id="memory" style="width: 600px; height:400px;"></div>
                </div>
                <div style="display: flex; gap: 30px;">
                    <div id="gpu" style="width: 600px; height:400px;"></div>
                    <div id="gpu_memory" style="width: 600px; height:400px;"></div>
                </div>
                <div style="display: flex; gap: 30px; margin-top: 30px;">
                    <div id="disk" style="width: 400px; height:400px;"></div>
                </div>
            </div>
            <div class="tabcontent" id="logs">
                <h3>日志检查</h3>
                <iframe src="/log" style="width: 100%; height: 600px; border: none;"></iframe>
            </div>
            <div class="tabcontent" id="tree">
                <iframe src="/tree" style="width: 100%; height: 600px; border: none;"></iframe>
            </div>
            <div class="tabcontent" id="tensorboard">
                <iframe src="/proxy" style="width: 100%; height: 600px; border: none;"></iframe>
            </div>
         <script>
            // 加载用户信息
            fetch('/auth/api/user/info')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('currentUser').textContent = `欢迎，${data.username}`;
                    if (data.is_admin) {
                        document.getElementById('adminLink').style.display = 'inline';
                    }
                })
                .catch(error => {
                    console.error('加载用户信息失败:', error);
                    document.getElementById('currentUser').textContent = '用户信息加载失败';
                });
         </script>
         <script src="/static/js/main.js"></script>
    </body>
</html>
